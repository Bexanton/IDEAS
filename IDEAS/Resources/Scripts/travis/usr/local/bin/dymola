#!/bin/bash
# This is invoked from the IDEAS directory.
# Hence, we need to share one level up
cur_dir=`pwd`
bas_nam=`basename ${cur_dir}`
sha_dir=`dirname ${cur_dir}`
# If the current directory is part of the argument list,
# replace it with . as the docker may have a different file structure
echo ${sha_dir}
ls -la
chmod a+rwx ${bas_nam}
arg_lis=`echo $@ | sed -e "s|${cur_dir}|.|g"`
docker run \
          --user=${UID} \
	  --mac-address=${MAC_ADDRESS} \
	  --detach=false \
	  --rm \
	  --user=developer \
	  -v ${sha_dir}:/mnt/shared:Z \
	  ${DOCKER_USERNAME}/private:unittests /bin/bash -c \
	  "Xvfb :77  -extension RANDR -extension GLX & \
	  export DISPLAY=:77.0 && \
          ls -la /mnt/shared && ls -la /mnt/shared/IDEAS
	  cd /mnt/shared/${bas_nam} && \
	  dymola ${arg_lis}"
